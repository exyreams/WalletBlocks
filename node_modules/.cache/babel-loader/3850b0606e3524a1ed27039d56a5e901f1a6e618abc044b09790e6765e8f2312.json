{"ast":null,"code":"\"use strict\";\n\n// Copyright (c) 2018-2022 Coinbase, Inc. <https://www.coinbase.com/>\n// Licensed under the Apache License, version 2.0\nvar _slicedToArray = require(\"D:/Projects/RainbowKit/connectwallet/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/slicedToArray.js\").default;\nvar _classCallCheck = require(\"D:/Projects/RainbowKit/connectwallet/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\nvar _createClass = require(\"D:/Projects/RainbowKit/connectwallet/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass.js\").default;\nvar _inherits = require(\"D:/Projects/RainbowKit/connectwallet/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/inherits.js\").default;\nvar _createSuper = require(\"D:/Projects/RainbowKit/connectwallet/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createSuper.js\").default;\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function get() {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n    r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n    d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.WalletSDKRelay = void 0;\nvar bind_decorator_1 = __importDefault(require(\"bind-decorator\"));\nvar eth_rpc_errors_1 = require(\"eth-rpc-errors\");\nvar rxjs_1 = require(\"rxjs\");\nvar operators_1 = require(\"rxjs/operators\");\nvar DiagnosticLogger_1 = require(\"../connection/DiagnosticLogger\");\nvar WalletSDKConnection_1 = require(\"../connection/WalletSDKConnection\");\nvar WalletUIError_1 = require(\"../provider/WalletUIError\");\nvar types_1 = require(\"../types\");\nvar util_1 = require(\"../util\");\nvar aes256gcm = __importStar(require(\"./aes256gcm\"));\nvar Session_1 = require(\"./Session\");\nvar WalletSDKRelayAbstract_1 = require(\"./WalletSDKRelayAbstract\");\nvar Web3Method_1 = require(\"./Web3Method\");\nvar Web3RequestCanceledMessage_1 = require(\"./Web3RequestCanceledMessage\");\nvar Web3RequestMessage_1 = require(\"./Web3RequestMessage\");\nvar Web3Response_1 = require(\"./Web3Response\");\nvar Web3ResponseMessage_1 = require(\"./Web3ResponseMessage\");\nvar WalletSDKRelay = /*#__PURE__*/function (_WalletSDKRelayAbstra) {\n  _inherits(WalletSDKRelay, _WalletSDKRelayAbstra);\n  var _super = _createSuper(WalletSDKRelay);\n  function WalletSDKRelay(options) {\n    var _this;\n    _classCallCheck(this, WalletSDKRelay);\n    var _a;\n    _this = _super.call(this);\n    _this.accountsCallback = null;\n    _this.chainCallback = null;\n    _this.dappDefaultChainSubject = new rxjs_1.BehaviorSubject(1);\n    _this.dappDefaultChain = 1;\n    _this.appName = \"\";\n    _this.appLogoUrl = null;\n    _this.subscriptions = new rxjs_1.Subscription();\n    _this.linkAPIUrl = options.linkAPIUrl;\n    _this.storage = options.storage;\n    _this.options = options;\n    var _this$subscribe = _this.subscribe(),\n      session = _this$subscribe.session,\n      ui = _this$subscribe.ui,\n      connection = _this$subscribe.connection;\n    _this._session = session;\n    _this.connection = connection;\n    _this.relayEventManager = options.relayEventManager;\n    if (options.diagnosticLogger && options.eventListener) {\n      throw new Error(\"Can't have both eventListener and diagnosticLogger options, use only diagnosticLogger\");\n    }\n    if (options.eventListener) {\n      _this.diagnostic = {\n        // eslint-disable-next-line @typescript-eslint/unbound-method\n        log: options.eventListener.onEvent\n      };\n    } else {\n      _this.diagnostic = options.diagnosticLogger;\n    }\n    _this._reloadOnDisconnect = (_a = options.reloadOnDisconnect) !== null && _a !== void 0 ? _a : true;\n    _this.ui = ui;\n    return _this;\n  }\n  _createClass(WalletSDKRelay, [{\n    key: \"subscribe\",\n    value: function subscribe() {\n      var _this2 = this;\n      this.subscriptions.add(this.dappDefaultChainSubject.subscribe(function (chainId) {\n        if (_this2.dappDefaultChain !== chainId) {\n          _this2.dappDefaultChain = chainId;\n        }\n      }));\n      var session = Session_1.Session.load(this.storage) || new Session_1.Session(this.storage).save();\n      var connection = new WalletSDKConnection_1.WalletSDKConnection(session.id, session.key, this.linkAPIUrl, this.diagnostic);\n      this.subscriptions.add(connection.sessionConfig$.subscribe({\n        next: function next(sessionConfig) {\n          _this2.onSessionConfigChanged(sessionConfig);\n        },\n        error: function error() {\n          var _a;\n          (_a = _this2.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.GENERAL_ERROR, {\n            message: \"error while invoking session config callback\"\n          });\n        }\n      }));\n      this.subscriptions.add(connection.incomingEvent$.pipe((0, operators_1.filter)(function (m) {\n        return m.event === \"Web3Response\";\n      })).subscribe({\n        next: this.handleIncomingEvent\n      }));\n      this.subscriptions.add(connection.linked$.pipe((0, operators_1.skip)(1), (0, operators_1.tap)(function (linked) {\n        var _a;\n        _this2.isLinked = linked;\n        var cachedAddresses = _this2.storage.getItem(WalletSDKRelayAbstract_1.LOCAL_STORAGE_ADDRESSES_KEY);\n        if (linked) {\n          // Only set linked session variable one way\n          _this2.session.linked = linked;\n        }\n        _this2.isUnlinkedErrorState = false;\n        if (cachedAddresses) {\n          var addresses = cachedAddresses.split(\" \");\n          var wasConnectedViaStandalone = _this2.storage.getItem(\"IsStandaloneSigning\") === \"true\";\n          if (addresses[0] !== \"\" && !linked && _this2.session.linked && !wasConnectedViaStandalone) {\n            _this2.isUnlinkedErrorState = true;\n            var sessionIdHash = _this2.getSessionIdHash();\n            (_a = _this2.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.UNLINKED_ERROR_STATE, {\n              sessionIdHash: sessionIdHash\n            });\n          }\n        }\n      })).subscribe());\n      // if session is marked destroyed, reset and reload\n      this.subscriptions.add(connection.sessionConfig$.pipe((0, operators_1.filter)(function (c) {\n        return !!c.metadata && c.metadata.__destroyed === \"1\";\n      })).subscribe(function () {\n        var _a;\n        var alreadyDestroyed = connection.isDestroyed;\n        (_a = _this2.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.METADATA_DESTROYED, {\n          alreadyDestroyed: alreadyDestroyed,\n          sessionIdHash: _this2.getSessionIdHash()\n        });\n        return _this2.resetAndReload();\n      }));\n      this.subscriptions.add(connection.sessionConfig$.pipe((0, operators_1.filter)(function (c) {\n        return c.metadata && c.metadata.WalletUsername !== undefined;\n      })).pipe((0, operators_1.mergeMap)(function (c) {\n        return aes256gcm.decrypt(c.metadata.WalletUsername, session.secret);\n      })).subscribe({\n        next: function next(walletUsername) {\n          _this2.storage.setItem(WalletSDKRelayAbstract_1.WALLET_USER_NAME_KEY, walletUsername);\n        },\n        error: function error() {\n          var _a;\n          (_a = _this2.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.GENERAL_ERROR, {\n            message: \"Had error decrypting\",\n            value: \"username\"\n          });\n        }\n      }));\n      this.subscriptions.add(connection.sessionConfig$.pipe((0, operators_1.filter)(function (c) {\n        return c.metadata && c.metadata.AppVersion !== undefined;\n      })).pipe((0, operators_1.mergeMap)(function (c) {\n        return aes256gcm.decrypt(c.metadata.AppVersion, session.secret);\n      })).subscribe({\n        next: function next(appVersion) {\n          _this2.storage.setItem(WalletSDKRelayAbstract_1.APP_VERSION_KEY, appVersion);\n        },\n        error: function error() {\n          var _a;\n          (_a = _this2.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.GENERAL_ERROR, {\n            message: \"Had error decrypting\",\n            value: \"appversion\"\n          });\n        }\n      }));\n      this.subscriptions.add(connection.sessionConfig$.pipe((0, operators_1.filter)(function (c) {\n        return c.metadata && c.metadata.ChainId !== undefined && c.metadata.JsonRpcUrl !== undefined;\n      })).pipe((0, operators_1.mergeMap)(function (c) {\n        return (0, rxjs_1.zip)(aes256gcm.decrypt(c.metadata.ChainId, session.secret), aes256gcm.decrypt(c.metadata.JsonRpcUrl, session.secret));\n      })).pipe((0, operators_1.distinctUntilChanged)()).subscribe({\n        next: function next(_ref) {\n          var _ref2 = _slicedToArray(_ref, 2),\n            chainId = _ref2[0],\n            jsonRpcUrl = _ref2[1];\n          if (_this2.chainCallback) {\n            _this2.chainCallback(chainId, jsonRpcUrl);\n          }\n        },\n        error: function error() {\n          var _a;\n          (_a = _this2.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.GENERAL_ERROR, {\n            message: \"Had error decrypting\",\n            value: \"chainId|jsonRpcUrl\"\n          });\n        }\n      }));\n      this.subscriptions.add(connection.sessionConfig$.pipe((0, operators_1.filter)(function (c) {\n        return c.metadata && c.metadata.EthereumAddress !== undefined;\n      })).pipe((0, operators_1.mergeMap)(function (c) {\n        return aes256gcm.decrypt(c.metadata.EthereumAddress, session.secret);\n      })).subscribe({\n        next: function next(selectedAddress) {\n          if (_this2.accountsCallback) {\n            _this2.accountsCallback([selectedAddress]);\n          }\n          if (WalletSDKRelay.accountRequestCallbackIds.size > 0) {\n            // We get the ethereum address from the metadata.  If for whatever\n            // reason we don't get a response via an explicit web3 message\n            // we can still fulfill the eip1102 request.\n            Array.from(WalletSDKRelay.accountRequestCallbackIds.values()).forEach(function (id) {\n              var message = (0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                id: id,\n                response: (0, Web3Response_1.RequestEthereumAccountsResponse)([selectedAddress])\n              });\n              _this2.invokeCallback(Object.assign(Object.assign({}, message), {\n                id: id\n              }));\n            });\n            WalletSDKRelay.accountRequestCallbackIds.clear();\n          }\n        },\n        error: function error() {\n          var _a;\n          (_a = _this2.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.GENERAL_ERROR, {\n            message: \"Had error decrypting\",\n            value: \"selectedAddress\"\n          });\n        }\n      }));\n      this.subscriptions.add(connection.sessionConfig$.pipe((0, operators_1.filter)(function (c) {\n        return c.metadata && c.metadata.AppSrc !== undefined;\n      })).pipe((0, operators_1.mergeMap)(function (c) {\n        return aes256gcm.decrypt(c.metadata.AppSrc, session.secret);\n      })).subscribe({\n        next: function next(appSrc) {\n          _this2.ui.setAppSrc(appSrc);\n        },\n        error: function error() {\n          var _a;\n          (_a = _this2.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.GENERAL_ERROR, {\n            message: \"Had error decrypting\",\n            value: \"appSrc\"\n          });\n        }\n      }));\n      var ui = this.options.uiConstructor({\n        linkAPIUrl: this.options.linkAPIUrl,\n        version: this.options.version,\n        darkMode: this.options.darkMode,\n        session: session,\n        connected$: connection.connected$,\n        chainId$: this.dappDefaultChainSubject\n      });\n      connection.connect();\n      return {\n        session: session,\n        ui: ui,\n        connection: connection\n      };\n    }\n  }, {\n    key: \"attachUI\",\n    value: function attachUI() {\n      this.ui.attach();\n    }\n  }, {\n    key: \"resetAndReload\",\n    value: function resetAndReload() {\n      var _this3 = this;\n      this.connection.setSessionMetadata(\"__destroyed\", \"1\").pipe((0, operators_1.timeout)(1000), (0, operators_1.catchError)(function (_) {\n        return (0, rxjs_1.of)(null);\n      })).subscribe(function (_) {\n        var _a, _b, _c;\n        var isStandalone = _this3.ui.isStandalone();\n        try {\n          _this3.subscriptions.unsubscribe();\n        } catch (err) {\n          (_a = _this3.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.GENERAL_ERROR, {\n            message: \"Had error unsubscribing\"\n          });\n        }\n        (_b = _this3.diagnostic) === null || _b === void 0 ? void 0 : _b.log(DiagnosticLogger_1.EVENTS.SESSION_STATE_CHANGE, {\n          method: \"relay::resetAndReload\",\n          sessionMetadataChange: \"__destroyed, 1\",\n          sessionIdHash: _this3.getSessionIdHash()\n        });\n        _this3.connection.destroy();\n        /**\n         * Only clear storage if the session id we have in memory matches the one on disk\n         * Otherwise, in the case where we have 2 tabs, another tab might have cleared\n         * storage already.  In that case if we clear storage again, the user will be in\n         * a state where the first tab allows the user to connect but the session that\n         * was used isn't persisted.  This leaves the user in a state where they aren't\n         * connected to the mobile app.\n         */\n        var storedSession = Session_1.Session.load(_this3.storage);\n        if ((storedSession === null || storedSession === void 0 ? void 0 : storedSession.id) === _this3._session.id) {\n          _this3.storage.clear();\n        } else if (storedSession) {\n          (_c = _this3.diagnostic) === null || _c === void 0 ? void 0 : _c.log(DiagnosticLogger_1.EVENTS.SKIPPED_CLEARING_SESSION, {\n            sessionIdHash: _this3.getSessionIdHash(),\n            storedSessionIdHash: Session_1.Session.hash(storedSession.id)\n          });\n        }\n        if (_this3._reloadOnDisconnect) {\n          _this3.ui.reloadUI();\n          return;\n        }\n        if (_this3.accountsCallback) {\n          _this3.accountsCallback([], true);\n        }\n        _this3.subscriptions = new rxjs_1.Subscription();\n        var _this3$subscribe = _this3.subscribe(),\n          session = _this3$subscribe.session,\n          ui = _this3$subscribe.ui,\n          connection = _this3$subscribe.connection;\n        _this3._session = session;\n        _this3.connection = connection;\n        _this3.ui = ui;\n        if (isStandalone && _this3.ui.setStandalone) _this3.ui.setStandalone(true);\n        _this3.attachUI();\n      }, function (err) {\n        var _a;\n        (_a = _this3.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.FAILURE, {\n          method: \"relay::resetAndReload\",\n          message: \"failed to reset and reload with \".concat(err),\n          sessionIdHash: _this3.getSessionIdHash()\n        });\n      });\n    }\n  }, {\n    key: \"setAppInfo\",\n    value: function setAppInfo(appName, appLogoUrl) {\n      this.appName = appName;\n      this.appLogoUrl = appLogoUrl;\n    }\n  }, {\n    key: \"getStorageItem\",\n    value: function getStorageItem(key) {\n      return this.storage.getItem(key);\n    }\n  }, {\n    key: \"session\",\n    get: function get() {\n      return this._session;\n    }\n  }, {\n    key: \"setStorageItem\",\n    value: function setStorageItem(key, value) {\n      this.storage.setItem(key, value);\n    }\n  }, {\n    key: \"signEthereumMessage\",\n    value: function signEthereumMessage(message, address, addPrefix, typedDataJson) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.signEthereumMessage,\n        params: {\n          message: (0, util_1.hexStringFromBuffer)(message, true),\n          address: address,\n          addPrefix: addPrefix,\n          typedDataJson: typedDataJson || null\n        }\n      });\n    }\n  }, {\n    key: \"ethereumAddressFromSignedMessage\",\n    value: function ethereumAddressFromSignedMessage(message, signature, addPrefix) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.ethereumAddressFromSignedMessage,\n        params: {\n          message: (0, util_1.hexStringFromBuffer)(message, true),\n          signature: (0, util_1.hexStringFromBuffer)(signature, true),\n          addPrefix: addPrefix\n        }\n      });\n    }\n  }, {\n    key: \"signEthereumTransaction\",\n    value: function signEthereumTransaction(params) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.signEthereumTransaction,\n        params: {\n          fromAddress: params.fromAddress,\n          toAddress: params.toAddress,\n          weiValue: (0, util_1.bigIntStringFromBN)(params.weiValue),\n          data: (0, util_1.hexStringFromBuffer)(params.data, true),\n          nonce: params.nonce,\n          gasPriceInWei: params.gasPriceInWei ? (0, util_1.bigIntStringFromBN)(params.gasPriceInWei) : null,\n          maxFeePerGas: params.gasPriceInWei ? (0, util_1.bigIntStringFromBN)(params.gasPriceInWei) : null,\n          maxPriorityFeePerGas: params.gasPriceInWei ? (0, util_1.bigIntStringFromBN)(params.gasPriceInWei) : null,\n          gasLimit: params.gasLimit ? (0, util_1.bigIntStringFromBN)(params.gasLimit) : null,\n          chainId: params.chainId,\n          shouldSubmit: false\n        }\n      });\n    }\n  }, {\n    key: \"signAndSubmitEthereumTransaction\",\n    value: function signAndSubmitEthereumTransaction(params) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.signEthereumTransaction,\n        params: {\n          fromAddress: params.fromAddress,\n          toAddress: params.toAddress,\n          weiValue: (0, util_1.bigIntStringFromBN)(params.weiValue),\n          data: (0, util_1.hexStringFromBuffer)(params.data, true),\n          nonce: params.nonce,\n          gasPriceInWei: params.gasPriceInWei ? (0, util_1.bigIntStringFromBN)(params.gasPriceInWei) : null,\n          maxFeePerGas: params.maxFeePerGas ? (0, util_1.bigIntStringFromBN)(params.maxFeePerGas) : null,\n          maxPriorityFeePerGas: params.maxPriorityFeePerGas ? (0, util_1.bigIntStringFromBN)(params.maxPriorityFeePerGas) : null,\n          gasLimit: params.gasLimit ? (0, util_1.bigIntStringFromBN)(params.gasLimit) : null,\n          chainId: params.chainId,\n          shouldSubmit: true\n        }\n      });\n    }\n  }, {\n    key: \"submitEthereumTransaction\",\n    value: function submitEthereumTransaction(signedTransaction, chainId) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.submitEthereumTransaction,\n        params: {\n          signedTransaction: (0, util_1.hexStringFromBuffer)(signedTransaction, true),\n          chainId: chainId\n        }\n      });\n    }\n  }, {\n    key: \"scanQRCode\",\n    value: function scanQRCode(regExp) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.scanQRCode,\n        params: {\n          regExp: regExp\n        }\n      });\n    }\n  }, {\n    key: \"getQRCodeUrl\",\n    value: function getQRCodeUrl() {\n      return (0, util_1.createQrUrl)(this._session.id, this._session.secret, this.linkAPIUrl, false, this.options.version, this.dappDefaultChain);\n    }\n  }, {\n    key: \"genericRequest\",\n    value: function genericRequest(data, action) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.generic,\n        params: {\n          action: action,\n          data: data\n        }\n      });\n    }\n  }, {\n    key: \"sendGenericMessage\",\n    value: function sendGenericMessage(request) {\n      return this.sendRequest(request);\n    }\n  }, {\n    key: \"sendRequest\",\n    value: function sendRequest(request) {\n      var _this4 = this;\n      var hideSnackbarItem = null;\n      var id = (0, util_1.randomBytesHex)(8);\n      var cancel = function cancel(error) {\n        _this4.publishWeb3RequestCanceledEvent(id);\n        _this4.handleErrorResponse(id, request.method, error);\n        hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n      };\n      var promise = new Promise(function (resolve, reject) {\n        if (!_this4.ui.isStandalone()) {\n          hideSnackbarItem = _this4.ui.showConnecting({\n            isUnlinkedErrorState: _this4.isUnlinkedErrorState,\n            onCancel: cancel,\n            onResetConnection: _this4.resetAndReload // eslint-disable-line @typescript-eslint/unbound-method\n          });\n        }\n\n        _this4.relayEventManager.callbacks.set(id, function (response) {\n          hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n          if (response.errorMessage) {\n            return reject(new Error(response.errorMessage));\n          }\n          resolve(response);\n        });\n        if (_this4.ui.isStandalone()) {\n          _this4.sendRequestStandalone(id, request);\n        } else {\n          _this4.publishWeb3RequestEvent(id, request);\n        }\n      });\n      return {\n        promise: promise,\n        cancel: cancel\n      };\n    }\n  }, {\n    key: \"setConnectDisabled\",\n    value: function setConnectDisabled(disabled) {\n      this.ui.setConnectDisabled(disabled);\n    }\n  }, {\n    key: \"setAccountsCallback\",\n    value: function setAccountsCallback(accountsCallback) {\n      this.accountsCallback = accountsCallback;\n    }\n  }, {\n    key: \"setChainCallback\",\n    value: function setChainCallback(chainCallback) {\n      this.chainCallback = chainCallback;\n    }\n  }, {\n    key: \"setDappDefaultChainCallback\",\n    value: function setDappDefaultChainCallback(chainId) {\n      this.dappDefaultChainSubject.next(chainId);\n    }\n  }, {\n    key: \"publishWeb3RequestEvent\",\n    value: function publishWeb3RequestEvent(id, request) {\n      var _this5 = this;\n      var _a;\n      var message = (0, Web3RequestMessage_1.Web3RequestMessage)({\n        id: id,\n        request: request\n      });\n      var storedSession = Session_1.Session.load(this.storage);\n      (_a = this.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.WEB3_REQUEST, {\n        eventId: message.id,\n        method: \"relay::\".concat(message.request.method),\n        sessionIdHash: this.getSessionIdHash(),\n        storedSessionIdHash: storedSession ? Session_1.Session.hash(storedSession.id) : \"\",\n        isSessionMismatched: ((storedSession === null || storedSession === void 0 ? void 0 : storedSession.id) !== this._session.id).toString()\n      });\n      this.subscriptions.add(this.publishEvent(\"Web3Request\", message, true).subscribe({\n        next: function next(_) {\n          var _a;\n          (_a = _this5.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.WEB3_REQUEST_PUBLISHED, {\n            eventId: message.id,\n            method: \"relay::\".concat(message.request.method),\n            sessionIdHash: _this5.getSessionIdHash(),\n            storedSessionIdHash: storedSession ? Session_1.Session.hash(storedSession.id) : \"\",\n            isSessionMismatched: ((storedSession === null || storedSession === void 0 ? void 0 : storedSession.id) !== _this5._session.id).toString()\n          });\n        },\n        error: function error(err) {\n          _this5.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n            id: message.id,\n            response: {\n              method: message.request.method,\n              errorMessage: err.message\n            }\n          }));\n        }\n      }));\n    }\n  }, {\n    key: \"publishWeb3RequestCanceledEvent\",\n    value: function publishWeb3RequestCanceledEvent(id) {\n      var message = (0, Web3RequestCanceledMessage_1.Web3RequestCanceledMessage)(id);\n      this.subscriptions.add(this.publishEvent(\"Web3RequestCanceled\", message, false).subscribe());\n    }\n  }, {\n    key: \"publishEvent\",\n    value: function publishEvent(event, message, callWebhook) {\n      var _this6 = this;\n      var secret = this.session.secret;\n      return new rxjs_1.Observable(function (subscriber) {\n        void aes256gcm.encrypt(JSON.stringify(Object.assign(Object.assign({}, message), {\n          origin: location.origin\n        })), secret).then(function (encrypted) {\n          subscriber.next(encrypted);\n          subscriber.complete();\n        });\n      }).pipe((0, operators_1.mergeMap)(function (encrypted) {\n        return _this6.connection.publishEvent(event, encrypted, callWebhook);\n      }));\n    }\n  }, {\n    key: \"handleIncomingEvent\",\n    value: function handleIncomingEvent(event) {\n      var _this7 = this;\n      try {\n        this.subscriptions.add((0, rxjs_1.from)(aes256gcm.decrypt(event.data, this.session.secret)).pipe((0, operators_1.map)(function (c) {\n          return JSON.parse(c);\n        })).subscribe({\n          next: function next(json) {\n            var message = (0, Web3ResponseMessage_1.isWeb3ResponseMessage)(json) ? json : null;\n            if (!message) {\n              return;\n            }\n            _this7.handleWeb3ResponseMessage(message);\n          },\n          error: function error() {\n            var _a;\n            (_a = _this7.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.GENERAL_ERROR, {\n              message: \"Had error decrypting\",\n              value: \"incomingEvent\"\n            });\n          }\n        }));\n      } catch (_a) {\n        return;\n      }\n    }\n  }, {\n    key: \"handleWeb3ResponseMessage\",\n    value: function handleWeb3ResponseMessage(message) {\n      var _this8 = this;\n      var _a;\n      var response = message.response;\n      (_a = this.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.WEB3_RESPONSE, {\n        eventId: message.id,\n        method: \"relay::\".concat(response.method),\n        sessionIdHash: this.getSessionIdHash()\n      });\n      if ((0, Web3Response_1.isRequestEthereumAccountsResponse)(response)) {\n        WalletSDKRelay.accountRequestCallbackIds.forEach(function (id) {\n          return _this8.invokeCallback(Object.assign(Object.assign({}, message), {\n            id: id\n          }));\n        });\n        WalletSDKRelay.accountRequestCallbackIds.clear();\n        return;\n      }\n      this.invokeCallback(message);\n    }\n  }, {\n    key: \"handleErrorResponse\",\n    value: function handleErrorResponse(id, method, error, errorCode) {\n      this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n        id: id,\n        response: (0, Web3Response_1.ErrorResponse)(method, (error !== null && error !== void 0 ? error : WalletUIError_1.WalletUIError.UserRejectedRequest).message, errorCode)\n      }));\n    }\n  }, {\n    key: \"invokeCallback\",\n    value: function invokeCallback(message) {\n      var callback = this.relayEventManager.callbacks.get(message.id);\n      if (callback) {\n        callback(message.response);\n        this.relayEventManager.callbacks.delete(message.id);\n      }\n    }\n  }, {\n    key: \"requestEthereumAccounts\",\n    value: function requestEthereumAccounts() {\n      var _this9 = this;\n      var request = {\n        method: Web3Method_1.Web3Method.requestEthereumAccounts,\n        params: {\n          appName: this.appName,\n          appLogoUrl: this.appLogoUrl || null\n        }\n      };\n      var hideSnackbarItem = null;\n      var id = (0, util_1.randomBytesHex)(8);\n      var cancel = function cancel(error) {\n        _this9.publishWeb3RequestCanceledEvent(id);\n        _this9.handleErrorResponse(id, request.method, error);\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore\n        hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n      };\n      var promise = new Promise(function (resolve, reject) {\n        var _a;\n        _this9.relayEventManager.callbacks.set(id, function (response) {\n          _this9.ui.hideRequestEthereumAccounts();\n          // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n          // @ts-ignore\n          hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n          if (response.errorMessage) {\n            return reject(new Error(response.errorMessage));\n          }\n          resolve(response);\n        });\n        var userAgent = ((_a = window === null || window === void 0 ? void 0 : window.navigator) === null || _a === void 0 ? void 0 : _a.userAgent) || null;\n        if (userAgent && /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent)) {\n          var _location;\n          try {\n            if ((0, util_1.isInIFrame)() && window.top) {\n              _location = window.top.location;\n            } else {\n              _location = window.location;\n            }\n          } catch (e) {\n            _location = window.location;\n          }\n          _location.href = \"https://www.coinbase.com/connect-dapp?uri=\".concat(encodeURIComponent(_location.href));\n          return;\n        }\n        if (_this9.ui.inlineAccountsResponse()) {\n          var onAccounts = function onAccounts(accounts) {\n            _this9.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n              id: id,\n              response: (0, Web3Response_1.RequestEthereumAccountsResponse)(accounts)\n            }));\n          };\n          _this9.ui.requestEthereumAccounts({\n            onCancel: cancel,\n            onAccounts: onAccounts\n          });\n        } else {\n          // Error if user closes TryExtensionLinkDialog without connecting\n          var err = eth_rpc_errors_1.ethErrors.provider.userRejectedRequest(\"User denied account authorization\");\n          _this9.ui.requestEthereumAccounts({\n            onCancel: function onCancel() {\n              return cancel(err);\n            }\n          });\n        }\n        WalletSDKRelay.accountRequestCallbackIds.add(id);\n        if (!_this9.ui.inlineAccountsResponse() && !_this9.ui.isStandalone()) {\n          _this9.publishWeb3RequestEvent(id, request);\n        }\n      });\n      return {\n        promise: promise,\n        cancel: cancel\n      };\n    }\n  }, {\n    key: \"selectProvider\",\n    value: function selectProvider(providerOptions) {\n      var _this10 = this;\n      var request = {\n        method: Web3Method_1.Web3Method.selectProvider,\n        params: {\n          providerOptions: providerOptions\n        }\n      };\n      var id = (0, util_1.randomBytesHex)(8);\n      var cancel = function cancel(error) {\n        _this10.publishWeb3RequestCanceledEvent(id);\n        _this10.handleErrorResponse(id, request.method, error);\n      };\n      var promise = new Promise(function (resolve, reject) {\n        _this10.relayEventManager.callbacks.set(id, function (response) {\n          if (response.errorMessage) {\n            return reject(new Error(response.errorMessage));\n          }\n          resolve(response);\n        });\n        var _cancel = function _cancel(_error) {\n          _this10.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n            id: id,\n            response: (0, Web3Response_1.SelectProviderResponse)(types_1.ProviderType.Unselected)\n          }));\n        };\n        var approve = function approve(selectedProviderKey) {\n          _this10.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n            id: id,\n            response: (0, Web3Response_1.SelectProviderResponse)(selectedProviderKey)\n          }));\n        };\n        if (_this10.ui.selectProvider) _this10.ui.selectProvider({\n          onApprove: approve,\n          onCancel: _cancel,\n          providerOptions: providerOptions\n        });\n      });\n      return {\n        cancel: cancel,\n        promise: promise\n      };\n    }\n  }, {\n    key: \"watchAsset\",\n    value: function watchAsset(type, address, symbol, decimals, image, chainId) {\n      var _this11 = this;\n      var request = {\n        method: Web3Method_1.Web3Method.watchAsset,\n        params: {\n          type: type,\n          options: {\n            address: address,\n            symbol: symbol,\n            decimals: decimals,\n            image: image\n          },\n          chainId: chainId\n        }\n      };\n      var hideSnackbarItem = null;\n      var id = (0, util_1.randomBytesHex)(8);\n      var cancel = function cancel(error) {\n        _this11.publishWeb3RequestCanceledEvent(id);\n        _this11.handleErrorResponse(id, request.method, error);\n        hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n      };\n      if (!this.ui.inlineWatchAsset()) {\n        hideSnackbarItem = this.ui.showConnecting({\n          isUnlinkedErrorState: this.isUnlinkedErrorState,\n          onCancel: cancel,\n          onResetConnection: this.resetAndReload // eslint-disable-line @typescript-eslint/unbound-method\n        });\n      }\n\n      var promise = new Promise(function (resolve, reject) {\n        _this11.relayEventManager.callbacks.set(id, function (response) {\n          hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n          if (response.errorMessage) {\n            return reject(new Error(response.errorMessage));\n          }\n          resolve(response);\n        });\n        var _cancel = function _cancel(_error) {\n          _this11.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n            id: id,\n            response: (0, Web3Response_1.WatchAssetReponse)(false)\n          }));\n        };\n        var approve = function approve() {\n          _this11.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n            id: id,\n            response: (0, Web3Response_1.WatchAssetReponse)(true)\n          }));\n        };\n        if (_this11.ui.inlineWatchAsset()) {\n          _this11.ui.watchAsset({\n            onApprove: approve,\n            onCancel: _cancel,\n            type: type,\n            address: address,\n            symbol: symbol,\n            decimals: decimals,\n            image: image,\n            chainId: chainId\n          });\n        }\n        if (!_this11.ui.inlineWatchAsset() && !_this11.ui.isStandalone()) {\n          _this11.publishWeb3RequestEvent(id, request);\n        }\n      });\n      return {\n        cancel: cancel,\n        promise: promise\n      };\n    }\n  }, {\n    key: \"addEthereumChain\",\n    value: function addEthereumChain(chainId, rpcUrls, iconUrls, blockExplorerUrls, chainName, nativeCurrency) {\n      var _this12 = this;\n      var request = {\n        method: Web3Method_1.Web3Method.addEthereumChain,\n        params: {\n          chainId: chainId,\n          rpcUrls: rpcUrls,\n          blockExplorerUrls: blockExplorerUrls,\n          chainName: chainName,\n          iconUrls: iconUrls,\n          nativeCurrency: nativeCurrency\n        }\n      };\n      var hideSnackbarItem = null;\n      var id = (0, util_1.randomBytesHex)(8);\n      var cancel = function cancel(error) {\n        _this12.publishWeb3RequestCanceledEvent(id);\n        _this12.handleErrorResponse(id, request.method, error);\n        hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n      };\n      if (!this.ui.inlineAddEthereumChain(chainId)) {\n        hideSnackbarItem = this.ui.showConnecting({\n          isUnlinkedErrorState: this.isUnlinkedErrorState,\n          onCancel: cancel,\n          onResetConnection: this.resetAndReload // eslint-disable-line @typescript-eslint/unbound-method\n        });\n      }\n\n      var promise = new Promise(function (resolve, reject) {\n        _this12.relayEventManager.callbacks.set(id, function (response) {\n          hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n          if (response.errorMessage) {\n            return reject(new Error(response.errorMessage));\n          }\n          resolve(response);\n        });\n        var _cancel = function _cancel(_error) {\n          _this12.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n            id: id,\n            response: (0, Web3Response_1.AddEthereumChainResponse)({\n              isApproved: false,\n              rpcUrl: \"\"\n            })\n          }));\n        };\n        var approve = function approve(rpcUrl) {\n          _this12.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n            id: id,\n            response: (0, Web3Response_1.AddEthereumChainResponse)({\n              isApproved: true,\n              rpcUrl: rpcUrl\n            })\n          }));\n        };\n        if (_this12.ui.inlineAddEthereumChain(chainId)) {\n          _this12.ui.addEthereumChain({\n            onCancel: _cancel,\n            onApprove: approve,\n            chainId: request.params.chainId,\n            rpcUrls: request.params.rpcUrls,\n            blockExplorerUrls: request.params.blockExplorerUrls,\n            chainName: request.params.chainName,\n            iconUrls: request.params.iconUrls,\n            nativeCurrency: request.params.nativeCurrency\n          });\n        }\n        if (!_this12.ui.inlineAddEthereumChain(chainId) && !_this12.ui.isStandalone()) {\n          _this12.publishWeb3RequestEvent(id, request);\n        }\n      });\n      return {\n        promise: promise,\n        cancel: cancel\n      };\n    }\n  }, {\n    key: \"switchEthereumChain\",\n    value: function switchEthereumChain(chainId, address) {\n      var _this13 = this;\n      var request = {\n        method: Web3Method_1.Web3Method.switchEthereumChain,\n        params: Object.assign({\n          chainId: chainId\n        }, {\n          address: address\n        })\n      };\n      var id = (0, util_1.randomBytesHex)(8);\n      var cancel = function cancel(error) {\n        _this13.publishWeb3RequestCanceledEvent(id);\n        _this13.handleErrorResponse(id, request.method, error);\n      };\n      var promise = new Promise(function (resolve, reject) {\n        _this13.relayEventManager.callbacks.set(id, function (response) {\n          if (response.errorMessage && response.errorCode) {\n            return reject(eth_rpc_errors_1.ethErrors.provider.custom({\n              code: response.errorCode,\n              message: \"Unrecognized chain ID. Try adding the chain using addEthereumChain first.\"\n            }));\n          } else if (response.errorMessage) {\n            return reject(new Error(response.errorMessage));\n          }\n          resolve(response);\n        });\n        var _cancel = function _cancel(error) {\n          if (typeof error === \"number\") {\n            // backward compatibility\n            var errorCode = error;\n            _this13.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n              id: id,\n              response: (0, Web3Response_1.ErrorResponse)(Web3Method_1.Web3Method.switchEthereumChain, WalletUIError_1.WalletUIError.SwitchEthereumChainUnsupportedChainId.message, errorCode)\n            }));\n          } else if (error instanceof WalletUIError_1.WalletUIError) {\n            _this13.handleErrorResponse(id, Web3Method_1.Web3Method.switchEthereumChain, error, error.errorCode);\n          } else {\n            _this13.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n              id: id,\n              response: (0, Web3Response_1.SwitchEthereumChainResponse)({\n                isApproved: false,\n                rpcUrl: \"\"\n              })\n            }));\n          }\n        };\n        var approve = function approve(rpcUrl) {\n          _this13.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n            id: id,\n            response: (0, Web3Response_1.SwitchEthereumChainResponse)({\n              isApproved: true,\n              rpcUrl: rpcUrl\n            })\n          }));\n        };\n        _this13.ui.switchEthereumChain({\n          onCancel: _cancel,\n          onApprove: approve,\n          chainId: request.params.chainId,\n          address: request.params.address\n        });\n        if (!_this13.ui.inlineSwitchEthereumChain() && !_this13.ui.isStandalone()) {\n          _this13.publishWeb3RequestEvent(id, request);\n        }\n      });\n      return {\n        promise: promise,\n        cancel: cancel\n      };\n    }\n  }, {\n    key: \"inlineAddEthereumChain\",\n    value: function inlineAddEthereumChain(chainId) {\n      return this.ui.inlineAddEthereumChain(chainId);\n    }\n  }, {\n    key: \"getSessionIdHash\",\n    value: function getSessionIdHash() {\n      return Session_1.Session.hash(this._session.id);\n    }\n  }, {\n    key: \"sendRequestStandalone\",\n    value: function sendRequestStandalone(id, request) {\n      var _this14 = this;\n      var _cancel = function _cancel(error) {\n        _this14.handleErrorResponse(id, request.method, error);\n      };\n      var onSuccess = function onSuccess(response) {\n        _this14.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n          id: id,\n          response: response\n        }));\n      };\n      switch (request.method) {\n        case Web3Method_1.Web3Method.signEthereumMessage:\n          this.ui.signEthereumMessage({\n            request: request,\n            onSuccess: onSuccess,\n            onCancel: _cancel\n          });\n          break;\n        case Web3Method_1.Web3Method.signEthereumTransaction:\n          this.ui.signEthereumTransaction({\n            request: request,\n            onSuccess: onSuccess,\n            onCancel: _cancel\n          });\n          break;\n        case Web3Method_1.Web3Method.submitEthereumTransaction:\n          this.ui.submitEthereumTransaction({\n            request: request,\n            onSuccess: onSuccess,\n            onCancel: _cancel\n          });\n          break;\n        case Web3Method_1.Web3Method.ethereumAddressFromSignedMessage:\n          this.ui.ethereumAddressFromSignedMessage({\n            request: request,\n            onSuccess: onSuccess\n          });\n          break;\n        default:\n          _cancel();\n          break;\n      }\n    }\n  }, {\n    key: \"onSessionConfigChanged\",\n    value: function onSessionConfigChanged(_nextSessionConfig) {}\n  }]);\n  return WalletSDKRelay;\n}(WalletSDKRelayAbstract_1.WalletSDKRelayAbstract);\nWalletSDKRelay.accountRequestCallbackIds = new Set();\n__decorate([bind_decorator_1.default], WalletSDKRelay.prototype, \"resetAndReload\", null);\n__decorate([bind_decorator_1.default], WalletSDKRelay.prototype, \"handleIncomingEvent\", null);\nexports.WalletSDKRelay = WalletSDKRelay;","map":{"version":3,"names":["_slicedToArray","require","default","_classCallCheck","_createClass","_inherits","_createSuper","__createBinding","Object","create","o","m","k","k2","undefined","defineProperty","enumerable","get","__setModuleDefault","v","value","__decorate","decorators","target","key","desc","c","arguments","length","r","getOwnPropertyDescriptor","d","Reflect","decorate","i","__importStar","mod","__esModule","result","prototype","hasOwnProperty","call","__importDefault","exports","WalletSDKRelay","bind_decorator_1","eth_rpc_errors_1","rxjs_1","operators_1","DiagnosticLogger_1","WalletSDKConnection_1","WalletUIError_1","types_1","util_1","aes256gcm","Session_1","WalletSDKRelayAbstract_1","Web3Method_1","Web3RequestCanceledMessage_1","Web3RequestMessage_1","Web3Response_1","Web3ResponseMessage_1","_WalletSDKRelayAbstra","_super","options","_this","_a","accountsCallback","chainCallback","dappDefaultChainSubject","BehaviorSubject","dappDefaultChain","appName","appLogoUrl","subscriptions","Subscription","linkAPIUrl","storage","_this$subscribe","subscribe","session","ui","connection","_session","relayEventManager","diagnosticLogger","eventListener","Error","diagnostic","log","onEvent","_reloadOnDisconnect","reloadOnDisconnect","_this2","add","chainId","Session","load","save","WalletSDKConnection","id","sessionConfig$","next","sessionConfig","onSessionConfigChanged","error","EVENTS","GENERAL_ERROR","message","incomingEvent$","pipe","filter","event","handleIncomingEvent","linked$","skip","tap","linked","isLinked","cachedAddresses","getItem","LOCAL_STORAGE_ADDRESSES_KEY","isUnlinkedErrorState","addresses","split","wasConnectedViaStandalone","sessionIdHash","getSessionIdHash","UNLINKED_ERROR_STATE","metadata","__destroyed","alreadyDestroyed","isDestroyed","METADATA_DESTROYED","resetAndReload","WalletUsername","mergeMap","decrypt","secret","walletUsername","setItem","WALLET_USER_NAME_KEY","AppVersion","appVersion","APP_VERSION_KEY","ChainId","JsonRpcUrl","zip","distinctUntilChanged","_ref","_ref2","jsonRpcUrl","EthereumAddress","selectedAddress","accountRequestCallbackIds","size","Array","from","values","forEach","Web3ResponseMessage","response","RequestEthereumAccountsResponse","invokeCallback","assign","clear","AppSrc","appSrc","setAppSrc","uiConstructor","version","darkMode","connected$","chainId$","connect","attachUI","attach","_this3","setSessionMetadata","timeout","catchError","_","of","_b","_c","isStandalone","unsubscribe","err","SESSION_STATE_CHANGE","method","sessionMetadataChange","destroy","storedSession","SKIPPED_CLEARING_SESSION","storedSessionIdHash","hash","reloadUI","_this3$subscribe","setStandalone","FAILURE","concat","setAppInfo","getStorageItem","setStorageItem","signEthereumMessage","address","addPrefix","typedDataJson","sendRequest","Web3Method","params","hexStringFromBuffer","ethereumAddressFromSignedMessage","signature","signEthereumTransaction","fromAddress","toAddress","weiValue","bigIntStringFromBN","data","nonce","gasPriceInWei","maxFeePerGas","maxPriorityFeePerGas","gasLimit","shouldSubmit","signAndSubmitEthereumTransaction","submitEthereumTransaction","signedTransaction","scanQRCode","regExp","getQRCodeUrl","createQrUrl","genericRequest","action","generic","sendGenericMessage","request","_this4","hideSnackbarItem","randomBytesHex","cancel","publishWeb3RequestCanceledEvent","handleErrorResponse","promise","Promise","resolve","reject","showConnecting","onCancel","onResetConnection","callbacks","set","errorMessage","sendRequestStandalone","publishWeb3RequestEvent","setConnectDisabled","disabled","setAccountsCallback","setChainCallback","setDappDefaultChainCallback","_this5","Web3RequestMessage","WEB3_REQUEST","eventId","isSessionMismatched","toString","publishEvent","WEB3_REQUEST_PUBLISHED","handleWeb3ResponseMessage","Web3RequestCanceledMessage","callWebhook","_this6","Observable","subscriber","encrypt","JSON","stringify","origin","location","then","encrypted","complete","_this7","map","parse","json","isWeb3ResponseMessage","_this8","WEB3_RESPONSE","isRequestEthereumAccountsResponse","errorCode","ErrorResponse","WalletUIError","UserRejectedRequest","callback","delete","requestEthereumAccounts","_this9","hideRequestEthereumAccounts","userAgent","window","navigator","test","isInIFrame","top","e","href","encodeURIComponent","inlineAccountsResponse","onAccounts","accounts","ethErrors","provider","userRejectedRequest","selectProvider","providerOptions","_this10","_cancel","_error","SelectProviderResponse","ProviderType","Unselected","approve","selectedProviderKey","onApprove","watchAsset","type","symbol","decimals","image","_this11","inlineWatchAsset","WatchAssetReponse","addEthereumChain","rpcUrls","iconUrls","blockExplorerUrls","chainName","nativeCurrency","_this12","inlineAddEthereumChain","AddEthereumChainResponse","isApproved","rpcUrl","switchEthereumChain","_this13","custom","code","SwitchEthereumChainUnsupportedChainId","SwitchEthereumChainResponse","inlineSwitchEthereumChain","_this14","onSuccess","_nextSessionConfig","WalletSDKRelayAbstract","Set"],"sources":["D:/Projects/RainbowKit/connectwallet/node_modules/@coinbase/wallet-sdk/dist/relay/WalletSDKRelay.js"],"sourcesContent":["\"use strict\";\n// Copyright (c) 2018-2022 Coinbase, Inc. <https://www.coinbase.com/>\n// Licensed under the Apache License, version 2.0\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WalletSDKRelay = void 0;\nconst bind_decorator_1 = __importDefault(require(\"bind-decorator\"));\nconst eth_rpc_errors_1 = require(\"eth-rpc-errors\");\nconst rxjs_1 = require(\"rxjs\");\nconst operators_1 = require(\"rxjs/operators\");\nconst DiagnosticLogger_1 = require(\"../connection/DiagnosticLogger\");\nconst WalletSDKConnection_1 = require(\"../connection/WalletSDKConnection\");\nconst WalletUIError_1 = require(\"../provider/WalletUIError\");\nconst types_1 = require(\"../types\");\nconst util_1 = require(\"../util\");\nconst aes256gcm = __importStar(require(\"./aes256gcm\"));\nconst Session_1 = require(\"./Session\");\nconst WalletSDKRelayAbstract_1 = require(\"./WalletSDKRelayAbstract\");\nconst Web3Method_1 = require(\"./Web3Method\");\nconst Web3RequestCanceledMessage_1 = require(\"./Web3RequestCanceledMessage\");\nconst Web3RequestMessage_1 = require(\"./Web3RequestMessage\");\nconst Web3Response_1 = require(\"./Web3Response\");\nconst Web3ResponseMessage_1 = require(\"./Web3ResponseMessage\");\nclass WalletSDKRelay extends WalletSDKRelayAbstract_1.WalletSDKRelayAbstract {\n    constructor(options) {\n        var _a;\n        super();\n        this.accountsCallback = null;\n        this.chainCallback = null;\n        this.dappDefaultChainSubject = new rxjs_1.BehaviorSubject(1);\n        this.dappDefaultChain = 1;\n        this.appName = \"\";\n        this.appLogoUrl = null;\n        this.subscriptions = new rxjs_1.Subscription();\n        this.linkAPIUrl = options.linkAPIUrl;\n        this.storage = options.storage;\n        this.options = options;\n        const { session, ui, connection } = this.subscribe();\n        this._session = session;\n        this.connection = connection;\n        this.relayEventManager = options.relayEventManager;\n        if (options.diagnosticLogger && options.eventListener) {\n            throw new Error(\"Can't have both eventListener and diagnosticLogger options, use only diagnosticLogger\");\n        }\n        if (options.eventListener) {\n            this.diagnostic = {\n                // eslint-disable-next-line @typescript-eslint/unbound-method\n                log: options.eventListener.onEvent,\n            };\n        }\n        else {\n            this.diagnostic = options.diagnosticLogger;\n        }\n        this._reloadOnDisconnect = (_a = options.reloadOnDisconnect) !== null && _a !== void 0 ? _a : true;\n        this.ui = ui;\n    }\n    subscribe() {\n        this.subscriptions.add(this.dappDefaultChainSubject.subscribe(chainId => {\n            if (this.dappDefaultChain !== chainId) {\n                this.dappDefaultChain = chainId;\n            }\n        }));\n        const session = Session_1.Session.load(this.storage) || new Session_1.Session(this.storage).save();\n        const connection = new WalletSDKConnection_1.WalletSDKConnection(session.id, session.key, this.linkAPIUrl, this.diagnostic);\n        this.subscriptions.add(connection.sessionConfig$.subscribe({\n            next: sessionConfig => {\n                this.onSessionConfigChanged(sessionConfig);\n            },\n            error: () => {\n                var _a;\n                (_a = this.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.GENERAL_ERROR, {\n                    message: \"error while invoking session config callback\",\n                });\n            },\n        }));\n        this.subscriptions.add(connection.incomingEvent$\n            .pipe((0, operators_1.filter)(m => m.event === \"Web3Response\"))\n            .subscribe({ next: this.handleIncomingEvent }));\n        this.subscriptions.add(connection.linked$\n            .pipe((0, operators_1.skip)(1), (0, operators_1.tap)((linked) => {\n            var _a;\n            this.isLinked = linked;\n            const cachedAddresses = this.storage.getItem(WalletSDKRelayAbstract_1.LOCAL_STORAGE_ADDRESSES_KEY);\n            if (linked) {\n                // Only set linked session variable one way\n                this.session.linked = linked;\n            }\n            this.isUnlinkedErrorState = false;\n            if (cachedAddresses) {\n                const addresses = cachedAddresses.split(\" \");\n                const wasConnectedViaStandalone = this.storage.getItem(\"IsStandaloneSigning\") === \"true\";\n                if (addresses[0] !== \"\" &&\n                    !linked &&\n                    this.session.linked &&\n                    !wasConnectedViaStandalone) {\n                    this.isUnlinkedErrorState = true;\n                    const sessionIdHash = this.getSessionIdHash();\n                    (_a = this.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.UNLINKED_ERROR_STATE, {\n                        sessionIdHash,\n                    });\n                }\n            }\n        }))\n            .subscribe());\n        // if session is marked destroyed, reset and reload\n        this.subscriptions.add(connection.sessionConfig$\n            .pipe((0, operators_1.filter)(c => !!c.metadata && c.metadata.__destroyed === \"1\"))\n            .subscribe(() => {\n            var _a;\n            const alreadyDestroyed = connection.isDestroyed;\n            (_a = this.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.METADATA_DESTROYED, {\n                alreadyDestroyed,\n                sessionIdHash: this.getSessionIdHash(),\n            });\n            return this.resetAndReload();\n        }));\n        this.subscriptions.add(connection.sessionConfig$\n            .pipe((0, operators_1.filter)(c => c.metadata && c.metadata.WalletUsername !== undefined))\n            .pipe((0, operators_1.mergeMap)(c => aes256gcm.decrypt(c.metadata.WalletUsername, session.secret)))\n            .subscribe({\n            next: walletUsername => {\n                this.storage.setItem(WalletSDKRelayAbstract_1.WALLET_USER_NAME_KEY, walletUsername);\n            },\n            error: () => {\n                var _a;\n                (_a = this.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.GENERAL_ERROR, {\n                    message: \"Had error decrypting\",\n                    value: \"username\",\n                });\n            },\n        }));\n        this.subscriptions.add(connection.sessionConfig$\n            .pipe((0, operators_1.filter)(c => c.metadata && c.metadata.AppVersion !== undefined))\n            .pipe((0, operators_1.mergeMap)(c => aes256gcm.decrypt(c.metadata.AppVersion, session.secret)))\n            .subscribe({\n            next: appVersion => {\n                this.storage.setItem(WalletSDKRelayAbstract_1.APP_VERSION_KEY, appVersion);\n            },\n            error: () => {\n                var _a;\n                (_a = this.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.GENERAL_ERROR, {\n                    message: \"Had error decrypting\",\n                    value: \"appversion\",\n                });\n            },\n        }));\n        this.subscriptions.add(connection.sessionConfig$\n            .pipe((0, operators_1.filter)(c => c.metadata &&\n            c.metadata.ChainId !== undefined &&\n            c.metadata.JsonRpcUrl !== undefined))\n            .pipe((0, operators_1.mergeMap)(c => (0, rxjs_1.zip)(aes256gcm.decrypt(c.metadata.ChainId, session.secret), aes256gcm.decrypt(c.metadata.JsonRpcUrl, session.secret))))\n            .pipe((0, operators_1.distinctUntilChanged)())\n            .subscribe({\n            next: ([chainId, jsonRpcUrl]) => {\n                if (this.chainCallback) {\n                    this.chainCallback(chainId, jsonRpcUrl);\n                }\n            },\n            error: () => {\n                var _a;\n                (_a = this.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.GENERAL_ERROR, {\n                    message: \"Had error decrypting\",\n                    value: \"chainId|jsonRpcUrl\",\n                });\n            },\n        }));\n        this.subscriptions.add(connection.sessionConfig$\n            .pipe((0, operators_1.filter)(c => c.metadata && c.metadata.EthereumAddress !== undefined))\n            .pipe((0, operators_1.mergeMap)(c => aes256gcm.decrypt(c.metadata.EthereumAddress, session.secret)))\n            .subscribe({\n            next: selectedAddress => {\n                if (this.accountsCallback) {\n                    this.accountsCallback([selectedAddress]);\n                }\n                if (WalletSDKRelay.accountRequestCallbackIds.size > 0) {\n                    // We get the ethereum address from the metadata.  If for whatever\n                    // reason we don't get a response via an explicit web3 message\n                    // we can still fulfill the eip1102 request.\n                    Array.from(WalletSDKRelay.accountRequestCallbackIds.values()).forEach(id => {\n                        const message = (0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                            id,\n                            response: (0, Web3Response_1.RequestEthereumAccountsResponse)([\n                                selectedAddress,\n                            ]),\n                        });\n                        this.invokeCallback(Object.assign(Object.assign({}, message), { id }));\n                    });\n                    WalletSDKRelay.accountRequestCallbackIds.clear();\n                }\n            },\n            error: () => {\n                var _a;\n                (_a = this.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.GENERAL_ERROR, {\n                    message: \"Had error decrypting\",\n                    value: \"selectedAddress\",\n                });\n            },\n        }));\n        this.subscriptions.add(connection.sessionConfig$\n            .pipe((0, operators_1.filter)(c => c.metadata && c.metadata.AppSrc !== undefined))\n            .pipe((0, operators_1.mergeMap)(c => aes256gcm.decrypt(c.metadata.AppSrc, session.secret)))\n            .subscribe({\n            next: appSrc => {\n                this.ui.setAppSrc(appSrc);\n            },\n            error: () => {\n                var _a;\n                (_a = this.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.GENERAL_ERROR, {\n                    message: \"Had error decrypting\",\n                    value: \"appSrc\",\n                });\n            },\n        }));\n        const ui = this.options.uiConstructor({\n            linkAPIUrl: this.options.linkAPIUrl,\n            version: this.options.version,\n            darkMode: this.options.darkMode,\n            session,\n            connected$: connection.connected$,\n            chainId$: this.dappDefaultChainSubject,\n        });\n        connection.connect();\n        return { session, ui, connection };\n    }\n    attachUI() {\n        this.ui.attach();\n    }\n    resetAndReload() {\n        this.connection\n            .setSessionMetadata(\"__destroyed\", \"1\")\n            .pipe((0, operators_1.timeout)(1000), (0, operators_1.catchError)(_ => (0, rxjs_1.of)(null)))\n            .subscribe(_ => {\n            var _a, _b, _c;\n            const isStandalone = this.ui.isStandalone();\n            try {\n                this.subscriptions.unsubscribe();\n            }\n            catch (err) {\n                (_a = this.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.GENERAL_ERROR, {\n                    message: \"Had error unsubscribing\",\n                });\n            }\n            (_b = this.diagnostic) === null || _b === void 0 ? void 0 : _b.log(DiagnosticLogger_1.EVENTS.SESSION_STATE_CHANGE, {\n                method: \"relay::resetAndReload\",\n                sessionMetadataChange: \"__destroyed, 1\",\n                sessionIdHash: this.getSessionIdHash(),\n            });\n            this.connection.destroy();\n            /**\n             * Only clear storage if the session id we have in memory matches the one on disk\n             * Otherwise, in the case where we have 2 tabs, another tab might have cleared\n             * storage already.  In that case if we clear storage again, the user will be in\n             * a state where the first tab allows the user to connect but the session that\n             * was used isn't persisted.  This leaves the user in a state where they aren't\n             * connected to the mobile app.\n             */\n            const storedSession = Session_1.Session.load(this.storage);\n            if ((storedSession === null || storedSession === void 0 ? void 0 : storedSession.id) === this._session.id) {\n                this.storage.clear();\n            }\n            else if (storedSession) {\n                (_c = this.diagnostic) === null || _c === void 0 ? void 0 : _c.log(DiagnosticLogger_1.EVENTS.SKIPPED_CLEARING_SESSION, {\n                    sessionIdHash: this.getSessionIdHash(),\n                    storedSessionIdHash: Session_1.Session.hash(storedSession.id),\n                });\n            }\n            if (this._reloadOnDisconnect) {\n                this.ui.reloadUI();\n                return;\n            }\n            if (this.accountsCallback) {\n                this.accountsCallback([], true);\n            }\n            this.subscriptions = new rxjs_1.Subscription();\n            const { session, ui, connection } = this.subscribe();\n            this._session = session;\n            this.connection = connection;\n            this.ui = ui;\n            if (isStandalone && this.ui.setStandalone)\n                this.ui.setStandalone(true);\n            this.attachUI();\n        }, (err) => {\n            var _a;\n            (_a = this.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.FAILURE, {\n                method: \"relay::resetAndReload\",\n                message: `failed to reset and reload with ${err}`,\n                sessionIdHash: this.getSessionIdHash(),\n            });\n        });\n    }\n    setAppInfo(appName, appLogoUrl) {\n        this.appName = appName;\n        this.appLogoUrl = appLogoUrl;\n    }\n    getStorageItem(key) {\n        return this.storage.getItem(key);\n    }\n    get session() {\n        return this._session;\n    }\n    setStorageItem(key, value) {\n        this.storage.setItem(key, value);\n    }\n    signEthereumMessage(message, address, addPrefix, typedDataJson) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.signEthereumMessage,\n            params: {\n                message: (0, util_1.hexStringFromBuffer)(message, true),\n                address,\n                addPrefix,\n                typedDataJson: typedDataJson || null,\n            },\n        });\n    }\n    ethereumAddressFromSignedMessage(message, signature, addPrefix) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.ethereumAddressFromSignedMessage,\n            params: {\n                message: (0, util_1.hexStringFromBuffer)(message, true),\n                signature: (0, util_1.hexStringFromBuffer)(signature, true),\n                addPrefix,\n            },\n        });\n    }\n    signEthereumTransaction(params) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.signEthereumTransaction,\n            params: {\n                fromAddress: params.fromAddress,\n                toAddress: params.toAddress,\n                weiValue: (0, util_1.bigIntStringFromBN)(params.weiValue),\n                data: (0, util_1.hexStringFromBuffer)(params.data, true),\n                nonce: params.nonce,\n                gasPriceInWei: params.gasPriceInWei\n                    ? (0, util_1.bigIntStringFromBN)(params.gasPriceInWei)\n                    : null,\n                maxFeePerGas: params.gasPriceInWei\n                    ? (0, util_1.bigIntStringFromBN)(params.gasPriceInWei)\n                    : null,\n                maxPriorityFeePerGas: params.gasPriceInWei\n                    ? (0, util_1.bigIntStringFromBN)(params.gasPriceInWei)\n                    : null,\n                gasLimit: params.gasLimit ? (0, util_1.bigIntStringFromBN)(params.gasLimit) : null,\n                chainId: params.chainId,\n                shouldSubmit: false,\n            },\n        });\n    }\n    signAndSubmitEthereumTransaction(params) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.signEthereumTransaction,\n            params: {\n                fromAddress: params.fromAddress,\n                toAddress: params.toAddress,\n                weiValue: (0, util_1.bigIntStringFromBN)(params.weiValue),\n                data: (0, util_1.hexStringFromBuffer)(params.data, true),\n                nonce: params.nonce,\n                gasPriceInWei: params.gasPriceInWei\n                    ? (0, util_1.bigIntStringFromBN)(params.gasPriceInWei)\n                    : null,\n                maxFeePerGas: params.maxFeePerGas\n                    ? (0, util_1.bigIntStringFromBN)(params.maxFeePerGas)\n                    : null,\n                maxPriorityFeePerGas: params.maxPriorityFeePerGas\n                    ? (0, util_1.bigIntStringFromBN)(params.maxPriorityFeePerGas)\n                    : null,\n                gasLimit: params.gasLimit ? (0, util_1.bigIntStringFromBN)(params.gasLimit) : null,\n                chainId: params.chainId,\n                shouldSubmit: true,\n            },\n        });\n    }\n    submitEthereumTransaction(signedTransaction, chainId) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.submitEthereumTransaction,\n            params: {\n                signedTransaction: (0, util_1.hexStringFromBuffer)(signedTransaction, true),\n                chainId,\n            },\n        });\n    }\n    scanQRCode(regExp) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.scanQRCode,\n            params: { regExp },\n        });\n    }\n    getQRCodeUrl() {\n        return (0, util_1.createQrUrl)(this._session.id, this._session.secret, this.linkAPIUrl, false, this.options.version, this.dappDefaultChain);\n    }\n    genericRequest(data, action) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.generic,\n            params: {\n                action,\n                data,\n            },\n        });\n    }\n    sendGenericMessage(request) {\n        return this.sendRequest(request);\n    }\n    sendRequest(request) {\n        let hideSnackbarItem = null;\n        const id = (0, util_1.randomBytesHex)(8);\n        const cancel = (error) => {\n            this.publishWeb3RequestCanceledEvent(id);\n            this.handleErrorResponse(id, request.method, error);\n            hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n        };\n        const promise = new Promise((resolve, reject) => {\n            if (!this.ui.isStandalone()) {\n                hideSnackbarItem = this.ui.showConnecting({\n                    isUnlinkedErrorState: this.isUnlinkedErrorState,\n                    onCancel: cancel,\n                    onResetConnection: this.resetAndReload, // eslint-disable-line @typescript-eslint/unbound-method\n                });\n            }\n            this.relayEventManager.callbacks.set(id, response => {\n                hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n                if (response.errorMessage) {\n                    return reject(new Error(response.errorMessage));\n                }\n                resolve(response);\n            });\n            if (this.ui.isStandalone()) {\n                this.sendRequestStandalone(id, request);\n            }\n            else {\n                this.publishWeb3RequestEvent(id, request);\n            }\n        });\n        return { promise, cancel };\n    }\n    setConnectDisabled(disabled) {\n        this.ui.setConnectDisabled(disabled);\n    }\n    setAccountsCallback(accountsCallback) {\n        this.accountsCallback = accountsCallback;\n    }\n    setChainCallback(chainCallback) {\n        this.chainCallback = chainCallback;\n    }\n    setDappDefaultChainCallback(chainId) {\n        this.dappDefaultChainSubject.next(chainId);\n    }\n    publishWeb3RequestEvent(id, request) {\n        var _a;\n        const message = (0, Web3RequestMessage_1.Web3RequestMessage)({ id, request });\n        const storedSession = Session_1.Session.load(this.storage);\n        (_a = this.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.WEB3_REQUEST, {\n            eventId: message.id,\n            method: `relay::${message.request.method}`,\n            sessionIdHash: this.getSessionIdHash(),\n            storedSessionIdHash: storedSession ? Session_1.Session.hash(storedSession.id) : \"\",\n            isSessionMismatched: ((storedSession === null || storedSession === void 0 ? void 0 : storedSession.id) !== this._session.id).toString(),\n        });\n        this.subscriptions.add(this.publishEvent(\"Web3Request\", message, true).subscribe({\n            next: _ => {\n                var _a;\n                (_a = this.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.WEB3_REQUEST_PUBLISHED, {\n                    eventId: message.id,\n                    method: `relay::${message.request.method}`,\n                    sessionIdHash: this.getSessionIdHash(),\n                    storedSessionIdHash: storedSession\n                        ? Session_1.Session.hash(storedSession.id)\n                        : \"\",\n                    isSessionMismatched: ((storedSession === null || storedSession === void 0 ? void 0 : storedSession.id) !== this._session.id).toString(),\n                });\n            },\n            error: err => {\n                this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                    id: message.id,\n                    response: {\n                        method: message.request.method,\n                        errorMessage: err.message,\n                    },\n                }));\n            },\n        }));\n    }\n    publishWeb3RequestCanceledEvent(id) {\n        const message = (0, Web3RequestCanceledMessage_1.Web3RequestCanceledMessage)(id);\n        this.subscriptions.add(this.publishEvent(\"Web3RequestCanceled\", message, false).subscribe());\n    }\n    publishEvent(event, message, callWebhook) {\n        const secret = this.session.secret;\n        return new rxjs_1.Observable(subscriber => {\n            void aes256gcm\n                .encrypt(JSON.stringify(Object.assign(Object.assign({}, message), { origin: location.origin })), secret)\n                .then((encrypted) => {\n                subscriber.next(encrypted);\n                subscriber.complete();\n            });\n        }).pipe((0, operators_1.mergeMap)((encrypted) => {\n            return this.connection.publishEvent(event, encrypted, callWebhook);\n        }));\n    }\n    handleIncomingEvent(event) {\n        try {\n            this.subscriptions.add((0, rxjs_1.from)(aes256gcm.decrypt(event.data, this.session.secret))\n                .pipe((0, operators_1.map)(c => JSON.parse(c)))\n                .subscribe({\n                next: json => {\n                    const message = (0, Web3ResponseMessage_1.isWeb3ResponseMessage)(json) ? json : null;\n                    if (!message) {\n                        return;\n                    }\n                    this.handleWeb3ResponseMessage(message);\n                },\n                error: () => {\n                    var _a;\n                    (_a = this.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.GENERAL_ERROR, {\n                        message: \"Had error decrypting\",\n                        value: \"incomingEvent\",\n                    });\n                },\n            }));\n        }\n        catch (_a) {\n            return;\n        }\n    }\n    handleWeb3ResponseMessage(message) {\n        var _a;\n        const { response } = message;\n        (_a = this.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.WEB3_RESPONSE, {\n            eventId: message.id,\n            method: `relay::${response.method}`,\n            sessionIdHash: this.getSessionIdHash(),\n        });\n        if ((0, Web3Response_1.isRequestEthereumAccountsResponse)(response)) {\n            WalletSDKRelay.accountRequestCallbackIds.forEach(id => this.invokeCallback(Object.assign(Object.assign({}, message), { id })));\n            WalletSDKRelay.accountRequestCallbackIds.clear();\n            return;\n        }\n        this.invokeCallback(message);\n    }\n    handleErrorResponse(id, method, error, errorCode) {\n        this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n            id,\n            response: (0, Web3Response_1.ErrorResponse)(method, (error !== null && error !== void 0 ? error : WalletUIError_1.WalletUIError.UserRejectedRequest).message, errorCode),\n        }));\n    }\n    invokeCallback(message) {\n        const callback = this.relayEventManager.callbacks.get(message.id);\n        if (callback) {\n            callback(message.response);\n            this.relayEventManager.callbacks.delete(message.id);\n        }\n    }\n    requestEthereumAccounts() {\n        const request = {\n            method: Web3Method_1.Web3Method.requestEthereumAccounts,\n            params: {\n                appName: this.appName,\n                appLogoUrl: this.appLogoUrl || null,\n            },\n        };\n        const hideSnackbarItem = null;\n        const id = (0, util_1.randomBytesHex)(8);\n        const cancel = (error) => {\n            this.publishWeb3RequestCanceledEvent(id);\n            this.handleErrorResponse(id, request.method, error);\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n        };\n        const promise = new Promise((resolve, reject) => {\n            var _a;\n            this.relayEventManager.callbacks.set(id, response => {\n                this.ui.hideRequestEthereumAccounts();\n                // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n                // @ts-ignore\n                hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n                if (response.errorMessage) {\n                    return reject(new Error(response.errorMessage));\n                }\n                resolve(response);\n            });\n            const userAgent = ((_a = window === null || window === void 0 ? void 0 : window.navigator) === null || _a === void 0 ? void 0 : _a.userAgent) || null;\n            if (userAgent &&\n                /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent)) {\n                let location;\n                try {\n                    if ((0, util_1.isInIFrame)() && window.top) {\n                        location = window.top.location;\n                    }\n                    else {\n                        location = window.location;\n                    }\n                }\n                catch (e) {\n                    location = window.location;\n                }\n                location.href = `https://www.coinbase.com/connect-dapp?uri=${encodeURIComponent(location.href)}`;\n                return;\n            }\n            if (this.ui.inlineAccountsResponse()) {\n                const onAccounts = (accounts) => {\n                    this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                        id,\n                        response: (0, Web3Response_1.RequestEthereumAccountsResponse)(accounts),\n                    }));\n                };\n                this.ui.requestEthereumAccounts({\n                    onCancel: cancel,\n                    onAccounts,\n                });\n            }\n            else {\n                // Error if user closes TryExtensionLinkDialog without connecting\n                const err = eth_rpc_errors_1.ethErrors.provider.userRejectedRequest(\"User denied account authorization\");\n                this.ui.requestEthereumAccounts({\n                    onCancel: () => cancel(err),\n                });\n            }\n            WalletSDKRelay.accountRequestCallbackIds.add(id);\n            if (!this.ui.inlineAccountsResponse() && !this.ui.isStandalone()) {\n                this.publishWeb3RequestEvent(id, request);\n            }\n        });\n        return { promise, cancel };\n    }\n    selectProvider(providerOptions) {\n        const request = {\n            method: Web3Method_1.Web3Method.selectProvider,\n            params: {\n                providerOptions,\n            },\n        };\n        const id = (0, util_1.randomBytesHex)(8);\n        const cancel = (error) => {\n            this.publishWeb3RequestCanceledEvent(id);\n            this.handleErrorResponse(id, request.method, error);\n        };\n        const promise = new Promise((resolve, reject) => {\n            this.relayEventManager.callbacks.set(id, response => {\n                if (response.errorMessage) {\n                    return reject(new Error(response.errorMessage));\n                }\n                resolve(response);\n            });\n            const _cancel = (_error) => {\n                this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                    id,\n                    response: (0, Web3Response_1.SelectProviderResponse)(types_1.ProviderType.Unselected),\n                }));\n            };\n            const approve = (selectedProviderKey) => {\n                this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                    id,\n                    response: (0, Web3Response_1.SelectProviderResponse)(selectedProviderKey),\n                }));\n            };\n            if (this.ui.selectProvider)\n                this.ui.selectProvider({\n                    onApprove: approve,\n                    onCancel: _cancel,\n                    providerOptions,\n                });\n        });\n        return { cancel, promise };\n    }\n    watchAsset(type, address, symbol, decimals, image, chainId) {\n        const request = {\n            method: Web3Method_1.Web3Method.watchAsset,\n            params: {\n                type,\n                options: {\n                    address,\n                    symbol,\n                    decimals,\n                    image,\n                },\n                chainId,\n            },\n        };\n        let hideSnackbarItem = null;\n        const id = (0, util_1.randomBytesHex)(8);\n        const cancel = (error) => {\n            this.publishWeb3RequestCanceledEvent(id);\n            this.handleErrorResponse(id, request.method, error);\n            hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n        };\n        if (!this.ui.inlineWatchAsset()) {\n            hideSnackbarItem = this.ui.showConnecting({\n                isUnlinkedErrorState: this.isUnlinkedErrorState,\n                onCancel: cancel,\n                onResetConnection: this.resetAndReload, // eslint-disable-line @typescript-eslint/unbound-method\n            });\n        }\n        const promise = new Promise((resolve, reject) => {\n            this.relayEventManager.callbacks.set(id, response => {\n                hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n                if (response.errorMessage) {\n                    return reject(new Error(response.errorMessage));\n                }\n                resolve(response);\n            });\n            const _cancel = (_error) => {\n                this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                    id,\n                    response: (0, Web3Response_1.WatchAssetReponse)(false),\n                }));\n            };\n            const approve = () => {\n                this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                    id,\n                    response: (0, Web3Response_1.WatchAssetReponse)(true),\n                }));\n            };\n            if (this.ui.inlineWatchAsset()) {\n                this.ui.watchAsset({\n                    onApprove: approve,\n                    onCancel: _cancel,\n                    type,\n                    address,\n                    symbol,\n                    decimals,\n                    image,\n                    chainId,\n                });\n            }\n            if (!this.ui.inlineWatchAsset() && !this.ui.isStandalone()) {\n                this.publishWeb3RequestEvent(id, request);\n            }\n        });\n        return { cancel, promise };\n    }\n    addEthereumChain(chainId, rpcUrls, iconUrls, blockExplorerUrls, chainName, nativeCurrency) {\n        const request = {\n            method: Web3Method_1.Web3Method.addEthereumChain,\n            params: {\n                chainId,\n                rpcUrls,\n                blockExplorerUrls,\n                chainName,\n                iconUrls,\n                nativeCurrency,\n            },\n        };\n        let hideSnackbarItem = null;\n        const id = (0, util_1.randomBytesHex)(8);\n        const cancel = (error) => {\n            this.publishWeb3RequestCanceledEvent(id);\n            this.handleErrorResponse(id, request.method, error);\n            hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n        };\n        if (!this.ui.inlineAddEthereumChain(chainId)) {\n            hideSnackbarItem = this.ui.showConnecting({\n                isUnlinkedErrorState: this.isUnlinkedErrorState,\n                onCancel: cancel,\n                onResetConnection: this.resetAndReload, // eslint-disable-line @typescript-eslint/unbound-method\n            });\n        }\n        const promise = new Promise((resolve, reject) => {\n            this.relayEventManager.callbacks.set(id, response => {\n                hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n                if (response.errorMessage) {\n                    return reject(new Error(response.errorMessage));\n                }\n                resolve(response);\n            });\n            const _cancel = (_error) => {\n                this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                    id,\n                    response: (0, Web3Response_1.AddEthereumChainResponse)({\n                        isApproved: false,\n                        rpcUrl: \"\",\n                    }),\n                }));\n            };\n            const approve = (rpcUrl) => {\n                this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                    id,\n                    response: (0, Web3Response_1.AddEthereumChainResponse)({ isApproved: true, rpcUrl }),\n                }));\n            };\n            if (this.ui.inlineAddEthereumChain(chainId)) {\n                this.ui.addEthereumChain({\n                    onCancel: _cancel,\n                    onApprove: approve,\n                    chainId: request.params.chainId,\n                    rpcUrls: request.params.rpcUrls,\n                    blockExplorerUrls: request.params.blockExplorerUrls,\n                    chainName: request.params.chainName,\n                    iconUrls: request.params.iconUrls,\n                    nativeCurrency: request.params.nativeCurrency,\n                });\n            }\n            if (!this.ui.inlineAddEthereumChain(chainId) && !this.ui.isStandalone()) {\n                this.publishWeb3RequestEvent(id, request);\n            }\n        });\n        return { promise, cancel };\n    }\n    switchEthereumChain(chainId, address) {\n        const request = {\n            method: Web3Method_1.Web3Method.switchEthereumChain,\n            params: Object.assign({ chainId }, { address }),\n        };\n        const id = (0, util_1.randomBytesHex)(8);\n        const cancel = (error) => {\n            this.publishWeb3RequestCanceledEvent(id);\n            this.handleErrorResponse(id, request.method, error);\n        };\n        const promise = new Promise((resolve, reject) => {\n            this.relayEventManager.callbacks.set(id, response => {\n                if (response.errorMessage && response.errorCode) {\n                    return reject(eth_rpc_errors_1.ethErrors.provider.custom({\n                        code: response.errorCode,\n                        message: `Unrecognized chain ID. Try adding the chain using addEthereumChain first.`,\n                    }));\n                }\n                else if (response.errorMessage) {\n                    return reject(new Error(response.errorMessage));\n                }\n                resolve(response);\n            });\n            const _cancel = (error) => {\n                if (typeof error === \"number\") {\n                    // backward compatibility\n                    const errorCode = error;\n                    this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                        id,\n                        response: (0, Web3Response_1.ErrorResponse)(Web3Method_1.Web3Method.switchEthereumChain, WalletUIError_1.WalletUIError.SwitchEthereumChainUnsupportedChainId.message, errorCode),\n                    }));\n                }\n                else if (error instanceof WalletUIError_1.WalletUIError) {\n                    this.handleErrorResponse(id, Web3Method_1.Web3Method.switchEthereumChain, error, error.errorCode);\n                }\n                else {\n                    this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                        id,\n                        response: (0, Web3Response_1.SwitchEthereumChainResponse)({\n                            isApproved: false,\n                            rpcUrl: \"\",\n                        }),\n                    }));\n                }\n            };\n            const approve = (rpcUrl) => {\n                this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                    id,\n                    response: (0, Web3Response_1.SwitchEthereumChainResponse)({\n                        isApproved: true,\n                        rpcUrl,\n                    }),\n                }));\n            };\n            this.ui.switchEthereumChain({\n                onCancel: _cancel,\n                onApprove: approve,\n                chainId: request.params.chainId,\n                address: request.params.address,\n            });\n            if (!this.ui.inlineSwitchEthereumChain() && !this.ui.isStandalone()) {\n                this.publishWeb3RequestEvent(id, request);\n            }\n        });\n        return { promise, cancel };\n    }\n    inlineAddEthereumChain(chainId) {\n        return this.ui.inlineAddEthereumChain(chainId);\n    }\n    getSessionIdHash() {\n        return Session_1.Session.hash(this._session.id);\n    }\n    sendRequestStandalone(id, request) {\n        const _cancel = (error) => {\n            this.handleErrorResponse(id, request.method, error);\n        };\n        const onSuccess = (response) => {\n            this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                id,\n                response,\n            }));\n        };\n        switch (request.method) {\n            case Web3Method_1.Web3Method.signEthereumMessage:\n                this.ui.signEthereumMessage({\n                    request,\n                    onSuccess,\n                    onCancel: _cancel,\n                });\n                break;\n            case Web3Method_1.Web3Method.signEthereumTransaction:\n                this.ui.signEthereumTransaction({\n                    request,\n                    onSuccess,\n                    onCancel: _cancel,\n                });\n                break;\n            case Web3Method_1.Web3Method.submitEthereumTransaction:\n                this.ui.submitEthereumTransaction({\n                    request,\n                    onSuccess,\n                    onCancel: _cancel,\n                });\n                break;\n            case Web3Method_1.Web3Method.ethereumAddressFromSignedMessage:\n                this.ui.ethereumAddressFromSignedMessage({\n                    request,\n                    onSuccess,\n                });\n                break;\n            default:\n                _cancel();\n                break;\n        }\n    }\n    onSessionConfigChanged(_nextSessionConfig) { }\n}\nWalletSDKRelay.accountRequestCallbackIds = new Set();\n__decorate([\n    bind_decorator_1.default\n], WalletSDKRelay.prototype, \"resetAndReload\", null);\n__decorate([\n    bind_decorator_1.default\n], WalletSDKRelay.prototype, \"handleIncomingEvent\", null);\nexports.WalletSDKRelay = WalletSDKRelay;\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}