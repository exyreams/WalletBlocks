{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"D:/Projects/RainbowKit/connectwallet/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/regeneratorRuntime.js\").default;\nvar _asyncToGenerator = require(\"D:/Projects/RainbowKit/connectwallet/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.createAsyncMiddleware = void 0;\n/**\n * JsonRpcEngine only accepts callback-based middleware directly.\n * createAsyncMiddleware exists to enable consumers to pass in async middleware\n * functions.\n *\n * Async middleware have no \"end\" function. Instead, they \"end\" if they return\n * without calling \"next\". Rather than passing in explicit return handlers,\n * async middleware can simply await \"next\", and perform operations on the\n * response object when execution resumes.\n *\n * To accomplish this, createAsyncMiddleware passes the async middleware a\n * wrapped \"next\" function. That function calls the internal JsonRpcEngine\n * \"next\" function with a return handler that resolves a promise when called.\n *\n * The return handler will always be called. Its resolution of the promise\n * enables the control flow described above.\n */\nfunction createAsyncMiddleware(asyncMiddleware) {\n  return /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(req, res, next, end) {\n      var resolveNextPromise, nextPromise, returnHandlerCallback, nextWasCalled, asyncNext;\n      return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n        while (1) switch (_context2.prev = _context2.next) {\n          case 0:\n            // nextPromise is the key to the implementation\n            // it is resolved by the return handler passed to the\n            // \"next\" function\n            nextPromise = new Promise(function (resolve) {\n              resolveNextPromise = resolve;\n            });\n            returnHandlerCallback = null;\n            nextWasCalled = false; // This will be called by the consumer's async middleware.\n            asyncNext = /*#__PURE__*/function () {\n              var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n                return _regeneratorRuntime().wrap(function _callee$(_context) {\n                  while (1) switch (_context.prev = _context.next) {\n                    case 0:\n                      nextWasCalled = true;\n                      // We pass a return handler to next(). When it is called by the engine,\n                      // the consumer's async middleware will resume executing.\n                      // eslint-disable-next-line node/callback-return\n                      next(function (runReturnHandlersCallback) {\n                        // This callback comes from JsonRpcEngine._runReturnHandlers\n                        returnHandlerCallback = runReturnHandlersCallback;\n                        resolveNextPromise();\n                      });\n                      _context.next = 4;\n                      return nextPromise;\n                    case 4:\n                    case \"end\":\n                      return _context.stop();\n                  }\n                }, _callee);\n              }));\n              return function asyncNext() {\n                return _ref2.apply(this, arguments);\n              };\n            }();\n            _context2.prev = 4;\n            _context2.next = 7;\n            return asyncMiddleware(req, res, asyncNext);\n          case 7:\n            if (!nextWasCalled) {\n              _context2.next = 13;\n              break;\n            }\n            _context2.next = 10;\n            return nextPromise;\n          case 10:\n            // we must wait until the return handler is called\n            returnHandlerCallback(null);\n            _context2.next = 14;\n            break;\n          case 13:\n            end(null);\n          case 14:\n            _context2.next = 19;\n            break;\n          case 16:\n            _context2.prev = 16;\n            _context2.t0 = _context2[\"catch\"](4);\n            if (returnHandlerCallback) {\n              returnHandlerCallback(_context2.t0);\n            } else {\n              end(_context2.t0);\n            }\n          case 19:\n          case \"end\":\n            return _context2.stop();\n        }\n      }, _callee2, null, [[4, 16]]);\n    }));\n    return function (_x, _x2, _x3, _x4) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n}\nexports.createAsyncMiddleware = createAsyncMiddleware;","map":{"version":3,"names":["createAsyncMiddleware","asyncMiddleware","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee2","req","res","next","end","resolveNextPromise","nextPromise","returnHandlerCallback","nextWasCalled","asyncNext","wrap","_callee2$","_context2","prev","Promise","resolve","_ref2","_callee","_callee$","_context","runReturnHandlersCallback","stop","apply","arguments","t0","_x","_x2","_x3","_x4","exports"],"sources":["../src/createAsyncMiddleware.ts"],"sourcesContent":[null],"mappings":";;;;;;;;AAgBA;;;;;;;;;;;;;;;;;AAiBA,SAAgBA,qBAAqBA,CACnCC,eAA6C;EAE7C;IAAA,IAAAC,IAAA,GAAAC,iBAAA,eAAAC,mBAAA,GAAAC,IAAA,CAAO,SAAAC,SAAOC,GAAG,EAAEC,GAAG,EAAEC,IAAI,EAAEC,GAAG;MAAA,IAAAC,kBAAA,EAAAC,WAAA,EAAAC,qBAAA,EAAAC,aAAA,EAAAC,SAAA;MAAA,OAAAX,mBAAA,GAAAY,IAAA,UAAAC,UAAAC,SAAA;QAAA,kBAAAA,SAAA,CAAAC,IAAA,GAAAD,SAAA,CAAAT,IAAA;UAAA;YAC/B;YACA;YACA;YAEMG,WAAW,GAAG,IAAIQ,OAAO,CAAC,UAACC,OAAO,EAAI;cAC1CV,kBAAkB,GAAGU,OAAO;YAC9B,CAAC,CAAC;YAEER,qBAAqB,GAAY,IAAI;YACrCC,aAAa,GAAG,KAAK,EAEzB;YACMC,SAAS;cAAA,IAAAO,KAAA,GAAAnB,iBAAA,eAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAAkB,QAAA;gBAAA,OAAAnB,mBAAA,GAAAY,IAAA,UAAAQ,SAAAC,QAAA;kBAAA,kBAAAA,QAAA,CAAAN,IAAA,GAAAM,QAAA,CAAAhB,IAAA;oBAAA;sBAChBK,aAAa,GAAG,IAAI;sBAEpB;sBACA;sBACA;sBACAL,IAAI,CAAC,UAACiB,yBAAyB,EAAI;wBACjC;wBACAb,qBAAqB,GAAGa,yBAAyB;wBACjDf,kBAAkB,EAAE;sBACtB,CAAC,CAAC;sBAACc,QAAA,CAAAhB,IAAA;sBAAA,OACGG,WAAW;oBAAA;oBAAA;sBAAA,OAAAa,QAAA,CAAAE,IAAA;kBAAA;gBAAA,GAAAJ,OAAA;cAAA,CAClB;cAAA,gBAZKR,SAASA,CAAA;gBAAA,OAAAO,KAAA,CAAAM,KAAA,OAAAC,SAAA;cAAA;YAAA;YAAAX,SAAA,CAAAC,IAAA;YAAAD,SAAA,CAAAT,IAAA;YAAA,OAePR,eAAe,CAACM,GAAG,EAAEC,GAAG,EAAEO,SAAS,CAAC;UAAA;YAAA,KAEtCD,aAAa;cAAAI,SAAA,CAAAT,IAAA;cAAA;YAAA;YAAAS,SAAA,CAAAT,IAAA;YAAA,OACTG,WAAW;UAAA;YAAE;YAClBC,qBAA+C,CAAC,IAAI,CAAC;YAACK,SAAA,CAAAT,IAAA;YAAA;UAAA;YAEvDC,GAAG,CAAC,IAAI,CAAC;UAAC;YAAAQ,SAAA,CAAAT,IAAA;YAAA;UAAA;YAAAS,SAAA,CAAAC,IAAA;YAAAD,SAAA,CAAAY,EAAA,GAAAZ,SAAA;YAGZ,IAAIL,qBAAqB,EAAE;cACxBA,qBAA+C,CAAAK,SAAA,CAAAY,EAAA,CAAO;aACxD,MAAM;cACLpB,GAAG,CAAAQ,SAAA,CAAAY,EAAA,CAAO;;UACX;UAAA;YAAA,OAAAZ,SAAA,CAAAS,IAAA;QAAA;MAAA,GAAArB,QAAA;IAAA,CAEJ;IAAA,iBAAAyB,EAAA,EAAAC,GAAA,EAAAC,GAAA,EAAAC,GAAA;MAAA,OAAAhC,IAAA,CAAA0B,KAAA,OAAAC,SAAA;IAAA;EAAA;AACH;AA/CAM,OAAA,CAAAnC,qBAAA,GAAAA,qBAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}